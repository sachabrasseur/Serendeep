<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serendeep - Outil de d√©veloppement narratif</title>
    <style>
/* SERENDEEP - Interface compl√®te */

:root {
    --primary: #2c3e50;
    --secondary: #3498db;
    --accent: #7c3aed;
    --success: #27ae60;
    --bg: #f5f5f5;
    --card-bg: #ffffff;
    --text: #2c3e50;
    --border: #e0e0e0;
    --hover-bg: #f0f0f0;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
}

/* Header */
.app-header {
    background: white;
    border-bottom: 1px solid var(--border);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.app-title {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.app-title h1 {
    font-size: 1.5rem;
    font-weight: 400;
}

.app-title h1 span {
    color: var(--accent);
    font-style: italic;
}

.project-info {
    color: #666;
    font-size: 0.9rem;
}

.project-badge {
    background: #e8e8e8;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
}

.header-actions {
    display: flex;
    gap: 0.75rem;
}

.icon-btn {
    background: white;
    border: 1px solid var(--border);
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.icon-btn:hover {
    background: var(--hover-bg);
}

/* Navigation Tabs */
.nav-tabs {
    background: white;
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    display: flex;
}

.nav-tab {
    padding: 1rem 1.5rem;
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    color: #666;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nav-tab:hover {
    color: var(--primary);
}

.nav-tab.active {
    color: var(--primary);
    border-bottom-color: var(--accent);
}

/* Main Layout */
.main-layout {
    display: flex;
    height: calc(100vh - 120px);
}

.main-content {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
}

/* Sidebar */
.sidebar {
    width: 450px;
    background: white;
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.sidebar.hidden {
    display: none;
}

.sidebar-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sidebar-header h2 {
    font-size: 1.1rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #666;
}

.close-sidebar {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #999;
}

.sidebar-content {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
}

/* Nuages Section */
.section {
    margin-bottom: 2rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 600;
}

.cloud-input {
    width: 100%;
    min-height: 120px;
    padding: 1rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-family: inherit;
    font-size: 0.95rem;
    resize: vertical;
    margin-bottom: 1rem;
}

.cloud-actions {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 2rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    background: #6d28d9;
}

.btn-secondary {
    background: white;
    border: 1px solid var(--border);
    color: var(--text);
}

.btn-secondary:hover {
    background: var(--hover-bg);
}

/* Filter Tabs */
.filter-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.filter-tab {
    padding: 0.5rem 1rem;
    background: white;
    border: 1px solid var(--border);
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s;
}

.filter-tab:hover {
    background: var(--hover-bg);
}

.filter-tab.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

/* Clouds Grid */
.clouds-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
}

.cloud-card {
    background: #fafafa;
    border: 2px solid transparent;
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.cloud-card:hover {
    border-color: var(--accent);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.cloud-card.selected {
    background: #f3e8ff;
    border-color: var(--accent);
}

.cloud-card.important::before {
    content: "‚òÜ";
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    color: #f59e0b;
    font-size: 1.2rem;
}

.cloud-card.explored::after {
    content: "‚úì";
    position: absolute;
    top: 0.75rem;
    right: 2.5rem;
    color: var(--success);
    font-size: 1.2rem;
    font-weight: bold;
}

.cloud-content {
    font-size: 0.95rem;
    font-style: italic;
    line-height: 1.5;
    color: #444;
    margin-bottom: 0.75rem;
}

.cloud-image {
    width: 100%;
    border-radius: 6px;
    margin-bottom: 0.75rem;
}

.cloud-footer {
    display: flex;
    gap: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border);
}

.cloud-btn {
    flex: 1;
    padding: 0.4rem;
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.2s;
}

.cloud-btn:hover {
    background: var(--hover-bg);
}

/* Dialogue Modes */
.dialogue-modes {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.mode-btn {
    flex: 1;
    padding: 0.75rem;
    background: white;
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    text-transform: uppercase;
    transition: all 0.2s;
}

.mode-btn:hover {
    background: var(--hover-bg);
}

.mode-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

/* Messages */
.messages-container {
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: 1rem;
}

.message {
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 8px;
}

.message.user {
    background: #f0f0f0;
}

.message.assistant {
    background: #f3e8ff;
}

.message-sender {
    font-weight: 600;
    margin-bottom: 0.5rem;
    font-size: 0.85rem;
    text-transform: uppercase;
}

.message-text {
    font-size: 0.95rem;
    line-height: 1.6;
}

.message-input-group {
    display: flex;
    gap: 0.5rem;
}

.message-input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-family: inherit;
}

.send-btn {
    padding: 0.75rem 1.5rem;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.2rem;
}

/* Tests Section */
.tests-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
}

.test-panel {
    background: white;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
}

.panel-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #666;
    margin-bottom: 1.5rem;
    font-weight: 600;
}

.combo-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.combo-clouds {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.combo-cloud-tag {
    background: #f0f0f0;
    padding: 0.25rem 0.75rem;
    border-radius: 16px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.remove-tag {
    cursor: pointer;
    color: #999;
    font-weight: bold;
}

.combo-modes {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.combo-mode-btn {
    padding: 0.5rem 1rem;
    background: white;
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.2s;
}

.combo-mode-btn.active {
    background: var(--primary);
    color: white;
}

.combo-question {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-family: inherit;
    margin-bottom: 0.75rem;
}

.combo-result {
    background: #fafafa;
    padding: 1.5rem;
    border-radius: 6px;
    margin: 1rem 0;
    font-size: 0.95rem;
    line-height: 1.7;
}

/* Saved Combinations */
.saved-combinations {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.saved-combo {
    background: #fafafa;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s;
}

.saved-combo:hover {
    border-color: var(--accent);
}

.saved-combo.active {
    background: #f3e8ff;
    border-color: var(--accent);
}

.saved-combo-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.saved-combo-title {
    font-weight: 600;
    font-size: 0.95rem;
}

.saved-combo-meta {
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.saved-combo-actions {
    display: flex;
    gap: 0.5rem;
}

.combo-action-btn {
    padding: 0.4rem 0.75rem;
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
}

/* Teaser Section */
.teaser-layout {
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    gap: 2rem;
}

.teaser-panel {
    background: white;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 2rem;
}

.teaser-content {
    min-height: 400px;
    font-size: 1rem;
    line-height: 1.8;
    white-space: pre-wrap;
    margin-bottom: 1.5rem;
}

.teaser-actions {
    display: flex;
    gap: 1rem;
}

.combo-selector {
    background: white;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
}

.combo-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.combo-item {
    padding: 1rem;
    background: #fafafa;
    border: 2px solid transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.combo-item:hover {
    border-color: var(--accent);
}

.combo-item.selected {
    background: #f3e8ff;
    border-color: var(--accent);
}

.combo-item-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.combo-item-meta {
    font-size: 0.8rem;
    color: #666;
}

/* Modal */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal.hidden {
    display: none;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    max-width: 500px;
    width: 90%;
}

.modal-header {
    margin-bottom: 1.5rem;
}

.modal-header h2 {
    font-size: 1.3rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 1rem;
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.radio-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
}

/* Utilities */
.hidden {
    display: none !important;
}

.empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: #999;
}

/* Settings icon */
.settings-icon {
    cursor: pointer;
    font-size: 1.2rem;
    color: #666;
}
    </style>
</head>
<body>

<!-- Header -->
<header class="app-header">
    <div class="app-title">
        <h1>Seren<span>deep</span></h1>
        <div class="project-info">
            <span id="projectName">Le rendez-vous secret</span> ‚Äî <span id="projectType" class="project-badge">podcast</span>
            <span id="cloudCount" style="margin-left: 1rem; color: #999;">3 nuages</span>
        </div>
    </div>
    <div class="header-actions">
        <button class="icon-btn" onclick="toggleSidebar('journal')">
            ‚ò∞ Journal
        </button>
        <button class="icon-btn" onclick="toggleSidebar('dialogue')">
            üí¨ Dialogue
        </button>
        <button class="icon-btn settings-icon" onclick="showSettings()">‚öôÔ∏è</button>
    </div>
</header>

<!-- Navigation -->
<nav class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('nuages')">Nuages</button>
    <button class="nav-tab" onclick="switchTab('tests')">Tests</button>
    <button class="nav-tab" onclick="switchTab('teaser')">Teaser</button>
    <button class="nav-tab" onclick="switchTab('projets')">Projets</button>
</nav>

<!-- Main Layout -->
<div class="main-layout">
    <!-- Main Content -->
    <main class="main-content">
        <!-- TAB: Nuages -->
        <div id="tab-nuages" class="tab-content">
            <div class="section">
                <textarea id="cloudInput" class="cloud-input" placeholder="D√©posez vos intuitions narratives ici..."></textarea>
                <div class="cloud-actions">
                    <button class="btn btn-primary" onclick="addCloud()">+ Nouveau nuage</button>
                    <label class="btn btn-secondary" style="cursor: pointer;">
                        üìé Image
                        <input type="file" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
                    </label>
                </div>

                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterClouds('all')">Tous</button>
                    <button class="filter-tab" onclick="filterClouds('important')">Importants</button>
                    <button class="filter-tab" onclick="filterClouds('explored')">Explor√©s</button>
                    <button class="filter-tab" onclick="filterClouds('unused')">Non utilis√©s</button>
                    <button class="filter-tab" onclick="filterClouds('images')">Avec images</button>
                </div>

                <div id="cloudsGrid" class="clouds-grid">
                    <!-- Clouds will be rendered here -->
                </div>
            </div>
        </div>

        <!-- TAB: Tests -->
        <div id="tab-tests" class="tab-content hidden">
            <div class="tests-layout">
                <!-- Active Combination -->
                <div class="test-panel">
                    <h3 class="panel-title">Combinaison active</h3>
                    
                    <div class="combo-header">
                        <button class="btn btn-primary" onclick="generateRandomCombo()">üé≤ G√©n√©rer al√©atoire</button>
                        <button class="btn btn-secondary" onclick="saveCurrentCombo()">‚úì Sauvegarder</button>
                    </div>

                    <!-- Cloud Selector -->
                    <div style="margin: 1.5rem 0;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">
                            S√©lectionner manuellement :
                        </label>
                        <div id="cloudSelectorTests" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem;">
                            <!-- Cloud checkboxes will be added here -->
                        </div>
                    </div>

                    <div id="activeComboClouds" class="combo-clouds">
                        <!-- Selected clouds tags -->
                    </div>

                    <div class="combo-modes">
                        <button class="combo-mode-btn active" data-mode="developer" onclick="selectComboMode('developer')">D√©velopper</button>
                        <button class="combo-mode-btn" data-mode="explorer" onclick="selectComboMode('explorer')">Explorer</button>
                        <button class="combo-mode-btn" data-mode="resister" onclick="selectComboMode('resister')">R√©sister</button>
                    </div>

                    <input type="text" class="combo-question" id="comboQuestion" placeholder="Qu'est-ce que √ßa raconte ?">
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="analyzeCombo()" style="flex: 1;">Analyser</button>
                        <button class="btn btn-secondary" onclick="clearComboResult()">Effacer</button>
                    </div>

                    <div id="comboResult" class="combo-result" style="display: none;">
                        <!-- Result will appear here -->
                    </div>
                </div>

                <!-- Saved Combinations -->
                <div class="test-panel">
                    <h3 class="panel-title">Combinaisons sauvegard√©es</h3>
                    <div id="savedCombinations" class="saved-combinations">
                        <!-- Saved combos will be listed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Teaser -->
        <div id="tab-teaser" class="tab-content hidden">
            <div class="teaser-layout">
                <!-- Teaser Content -->
                <div class="teaser-panel">
                    <h3 class="panel-title">Teaser narratif</h3>
                    <div id="teaserContent" class="teaser-content">
                        S√©lectionnez une combinaison pour g√©n√©rer un teaser...
                    </div>
                    <div class="teaser-actions">
                        <button class="btn btn-secondary" onclick="proposeTeaser()">‚≠ï Je propose un teaser</button>
                        <button class="btn btn-secondary" onclick="clearTeaser()">Effacer</button>
                        <button class="btn btn-primary" onclick="validateTeaser()">‚úì Valider ‚Äî Phase 2</button>
                    </div>
                </div>

                <!-- Combination Selector -->
                <div class="combo-selector">
                    <h3 class="panel-title">Depuis une combinaison</h3>
                    <div id="comboSelectorList" class="combo-list">
                        <!-- Combos for teaser generation -->
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Projets -->
        <div id="tab-projets" class="tab-content hidden">
            <button class="btn btn-primary" onclick="showNewProjectModal()">+ Nouveau projet</button>
            <div id="projectsList" style="margin-top: 2rem;">
                <!-- Projects list -->
            </div>
        </div>
    </main>

    <!-- Dialogue Sidebar -->
    <aside id="dialogueSidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <h2>Dialogue focalis√©</h2>
            <button class="close-sidebar" onclick="closeSidebar()">√ó</button>
        </div>
        <div class="sidebar-content">
            <p style="font-style: italic; color: #666; margin-bottom: 1rem;" id="dialogueContext">
                <!-- Context will be shown here -->
            </p>

            <div class="dialogue-modes">
                <button class="mode-btn active" data-mode="developer" onclick="selectDialogueMode('developer')">D√©velopper</button>
                <button class="mode-btn" data-mode="explorer" onclick="selectDialogueMode('explorer')">Explorer</button>
                <button class="mode-btn" data-mode="resister" onclick="selectDialogueMode('resister')">R√©sister</button>
            </div>

            <div id="dialogueMessages" class="messages-container">
                <!-- Messages will appear here -->
            </div>

            <div class="message-input-group">
                <input type="text" id="dialogueInput" class="message-input" placeholder="Interroger ce nuage...">
                <button class="send-btn" onclick="sendMessage()">‚Üí</button>
            </div>
        </div>
    </aside>

    <!-- Journal Sidebar -->
    <aside id="journalSidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <h2>Journal</h2>
            <button class="close-sidebar" onclick="closeSidebar()">√ó</button>
        </div>
        <div class="sidebar-content">
            <p style="color: #999;">Fonctionnalit√© Journal √† venir...</p>
        </div>
    </aside>
</div>

<!-- Modals -->
<div id="newProjectModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Nouveau projet</h2>
        </div>
        <div class="form-group">
            <label class="form-label">Nom du projet</label>
            <input type="text" id="newProjectName" class="form-input" placeholder="Ex: Le rendez-vous secret">
        </div>
        <div class="form-group">
            <label class="form-label">Type de projet</label>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="projectType" value="s√©rie" checked>
                    S√©rie
                </label>
                <label class="radio-option">
                    <input type="radio" name="projectType" value="film">
                    Film
                </label>
                <label class="radio-option">
                    <input type="radio" name="projectType" value="podcast">
                    Podcast
                </label>
                <label class="radio-option">
                    <input type="radio" name="projectType" value="documentaire">
                    Documentaire
                </label>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeNewProjectModal()">Annuler</button>
            <button class="btn btn-primary" onclick="createProject()">Cr√©er</button>
        </div>
    </div>
</div>

<script>
// ==========================================
// STATE
// ==========================================

let currentProject = {
    id: Date.now(),
    name: 'Le rendez-vous secret',
    type: 'podcast',
    clouds: [],
    combinations: [],
    teaser: ''
};

let selectedClouds = [];
let currentFilter = 'all';
let currentDialogueMode = 'developer';
let currentComboMode = 'developer';
let activeSidebar = null;

// ==========================================
// INITIALIZATION
// ==========================================

function init() {
    loadFromLocalStorage();
    renderClouds();
    updateCloudCount();
}

function loadFromLocalStorage() {
    const saved = localStorage.getItem('serendeep_project');
    if (saved) {
        currentProject = JSON.parse(saved);
        document.getElementById('projectName').textContent = currentProject.name;
        document.getElementById('projectType').textContent = currentProject.type;
    }
}

function saveToLocalStorage() {
    localStorage.setItem('serendeep_project', JSON.stringify(currentProject));
}

// ==========================================
// TABS
// ==========================================

function switchTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');

    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });

    // Show selected tab
    document.getElementById('tab-' + tabName).classList.remove('hidden');

    // Load data for specific tabs
    if (tabName === 'tests') {
        renderSavedCombinations();
        renderCloudSelectorTests();
    } else if (tabName === 'teaser') {
        renderComboSelector();
    }
}

// Render cloud selector in Tests tab
function renderCloudSelectorTests() {
    const container = document.getElementById('cloudSelectorTests');
    container.innerHTML = '';

    if (currentProject.clouds.length === 0) {
        container.innerHTML = '<div style="color: #999; font-size: 0.85rem;">Aucun nuage disponible</div>';
        return;
    }

    currentProject.clouds.forEach(cloud => {
        const label = document.createElement('label');
        label.style.display = 'flex';
        label.style.alignItems = 'center';
        label.style.gap = '0.5rem';
        label.style.padding = '0.5rem';
        label.style.cursor = 'pointer';
        label.style.borderRadius = '4px';
        label.style.transition = 'background 0.2s';
        
        label.onmouseover = () => label.style.background = '#f5f5f5';
        label.onmouseout = () => label.style.background = 'transparent';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = selectedClouds.includes(cloud.id);
        checkbox.onchange = () => toggleCloudForCombo(cloud.id);

        const text = document.createElement('span');
        text.style.fontSize = '0.85rem';
        text.textContent = cloud.content.substring(0, 60) + (cloud.content.length > 60 ? '...' : '');

        label.appendChild(checkbox);
        label.appendChild(text);
        container.appendChild(label);
    });
}

function toggleCloudForCombo(cloudId) {
    const index = selectedClouds.indexOf(cloudId);
    if (index > -1) {
        selectedClouds.splice(index, 1);
    } else {
        selectedClouds.push(cloudId);
    }
    renderCloudSelectorTests();
    updateActiveComboClouds();
}

function clearComboResult() {
    document.getElementById('comboResult').style.display = 'none';
    document.getElementById('comboResult').textContent = '';
    document.getElementById('comboQuestion').value = '';
}

// ==========================================
// SIDEBAR
// ==========================================

function toggleSidebar(type) {
    const dialogueSidebar = document.getElementById('dialogueSidebar');
    const journalSidebar = document.getElementById('journalSidebar');

    if (activeSidebar === type) {
        closeSidebar();
        return;
    }

    dialogueSidebar.classList.add('hidden');
    journalSidebar.classList.add('hidden');

    if (type === 'dialogue') {
        dialogueSidebar.classList.remove('hidden');
        updateDialogueContext();
    } else if (type === 'journal') {
        journalSidebar.classList.remove('hidden');
    }

    activeSidebar = type;
}

function closeSidebar() {
    document.getElementById('dialogueSidebar').classList.add('hidden');
    document.getElementById('journalSidebar').classList.add('hidden');
    activeSidebar = null;
}

function updateDialogueContext() {
    const contextEl = document.getElementById('dialogueContext');
    if (selectedClouds.length > 0) {
        const cloudTexts = selectedClouds.map(id => {
            const cloud = currentProject.clouds.find(c => c.id === id);
            return cloud ? cloud.content.substring(0, 60) + '...' : '';
        }).filter(Boolean).join(' ‚Ä¢ ');
        contextEl.textContent = cloudTexts;
    } else {
        contextEl.textContent = 'Aucun nuage s√©lectionn√©';
    }
}

// ==========================================
// CLOUDS
// ==========================================

function addCloud() {
    const input = document.getElementById('cloudInput');
    const content = input.value.trim();
    if (!content) {
        alert('Veuillez entrer du contenu');
        return;
    }

    const cloud = {
        id: Date.now(),
        content: content,
        image: null,
        important: false,
        explored: false
    };

    currentProject.clouds.push(cloud);
    input.value = '';
    saveToLocalStorage();
    renderClouds();
    updateCloudCount();
}

function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const input = document.getElementById('cloudInput');
        const content = input.value.trim() || 'Image sans texte';

        const cloud = {
            id: Date.now(),
            content: content,
            image: e.target.result,
            important: false,
            explored: false
        };

        currentProject.clouds.push(cloud);
        input.value = '';
        saveToLocalStorage();
        renderClouds();
        updateCloudCount();
    };
    reader.readAsDataURL(file);
}

function filterClouds(filter) {
    currentFilter = filter;
    document.querySelectorAll('.filter-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    renderClouds();
}

function toggleCloudSelection(cloudId) {
    const index = selectedClouds.indexOf(cloudId);
    if (index > -1) {
        selectedClouds.splice(index, 1);
    } else {
        selectedClouds.push(cloudId);
    }
    renderClouds();
    updateDialogueContext();
    updateActiveComboClouds();
}

function toggleImportant(cloudId, event) {
    event.stopPropagation();
    const cloud = currentProject.clouds.find(c => c.id === cloudId);
    if (cloud) {
        cloud.important = !cloud.important;
        saveToLocalStorage();
        renderClouds();
    }
}

function toggleExplored(cloudId, event) {
    event.stopPropagation();
    const cloud = currentProject.clouds.find(c => c.id === cloudId);
    if (cloud) {
        cloud.explored = !cloud.explored;
        saveToLocalStorage();
        renderClouds();
    }
}

function openDialogue(cloudId, event) {
    event.stopPropagation();
    
    // Reset dialogue messages
    document.getElementById('dialogueMessages').innerHTML = '';
    
    // Select only this cloud
    selectedClouds = [cloudId];
    renderClouds();
    toggleSidebar('dialogue');
}

function renderClouds() {
    const container = document.getElementById('cloudsGrid');
    container.innerHTML = '';

    let clouds = currentProject.clouds;

    // Apply filter
    if (currentFilter === 'important') {
        clouds = clouds.filter(c => c.important);
    } else if (currentFilter === 'explored') {
        clouds = clouds.filter(c => c.explored);
    } else if (currentFilter === 'unused') {
        clouds = clouds.filter(c => !c.important && !c.explored);
    } else if (currentFilter === 'images') {
        clouds = clouds.filter(c => c.image);
    }

    if (clouds.length === 0) {
        container.innerHTML = '<div class="empty-state">Aucun nuage ne correspond √† ce filtre</div>';
        return;
    }

    clouds.forEach(cloud => {
        const card = document.createElement('div');
        card.className = 'cloud-card';
        if (selectedClouds.includes(cloud.id)) card.className += ' selected';
        if (cloud.important) card.className += ' important';
        if (cloud.explored) card.className += ' explored';
        
        card.onclick = () => toggleCloudSelection(cloud.id);

        let html = '';
        if (cloud.image) {
            html += `<img src="${cloud.image}" class="cloud-image" alt="Image">`;
        }
        html += `<div class="cloud-content">${cloud.content}</div>`;
        html += `
            <div class="cloud-footer">
                <button class="cloud-btn" onclick="toggleImportant(${cloud.id}, event)">‚òÜ Imp</button>
                <button class="cloud-btn" onclick="toggleExplored(${cloud.id}, event)">‚úì Exp</button>
                <button class="cloud-btn" onclick="openDialogue(${cloud.id}, event)">üí¨ Dlg</button>
            </div>
        `;

        card.innerHTML = html;
        container.appendChild(card);
    });
}

function updateCloudCount() {
    document.getElementById('cloudCount').textContent = `${currentProject.clouds.length} nuage${currentProject.clouds.length > 1 ? 's' : ''}`;
}

// ==========================================
// DIALOGUE
// ==========================================

function selectDialogueMode(mode) {
    currentDialogueMode = mode;
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
}

async function sendMessage() {
    const input = document.getElementById('dialogueInput');
    const message = input.value.trim();
    if (!message) return;

    addMessage('user', message);
    input.value = '';

    // Prepare context
    const cloudContents = selectedClouds.map(id => {
        const cloud = currentProject.clouds.find(c => c.id === id);
        return cloud ? cloud.content : '';
    }).filter(Boolean);

    await generateDialogueResponse(message, cloudContents);
}

function addMessage(sender, text) {
    const container = document.getElementById('dialogueMessages');
    const message = document.createElement('div');
    message.className = `message ${sender}`;
    message.innerHTML = `
        <div class="message-sender">${sender === 'user' ? 'Vous' : 'Claude'}</div>
        <div class="message-text">${text}</div>
    `;
    container.appendChild(message);
    container.scrollTop = container.scrollHeight;
}

// Configuration API
const USE_DEMO_MODE = true; // Mettre √† false si vous avez une cl√© API
const API_KEY = ''; // Mettre votre cl√© API Anthropic ici

async function generateDialogueResponse(userMessage, cloudContents) {
    let systemPrompt = '';
    
    if (currentDialogueMode === 'explorer') {
        systemPrompt = `Tu es un assistant cr√©atif qui aide √† explorer et ouvrir les possibles narratifs. Encourage la divergence, propose des pistes inattendues.`;
    } else if (currentDialogueMode === 'developer') {
        systemPrompt = `Tu es un assistant qui aide √† d√©velopper les intuitions narratives. Type de projet: ${currentProject.type}. Pose des questions pr√©cises pour construire.`;
    } else if (currentDialogueMode === 'resister') {
        systemPrompt = `Tu es un assistant critique qui challenge les id√©es. Identifie les faiblesses, les clich√©s, les incoh√©rences potentielles.`;
    }

    const context = cloudContents.length > 0 ? `\n\nNuages s√©lectionn√©s:\n${cloudContents.join('\n\n')}` : '';
    const fullPrompt = `${systemPrompt}${context}\n\nQuestion: ${userMessage}`;

    // MODE DEMO : r√©ponses simul√©es pour tester l'interface
    if (USE_DEMO_MODE) {
        await new Promise(resolve => setTimeout(resolve, 1000)); // Simuler latence
        
        const demoResponses = {
            'explorer': "Cette intuition ouvre plusieurs pistes fascinantes !\n\n1. On pourrait explorer l'angle de la perception d√©form√©e : et si ce qui semble √™tre un mensonge √©tait en fait une v√©rit√© vue sous un autre angle ?\n\n2. L'id√©e du rituel annuel me fait penser √† une dimension mythologique. Peut-√™tre que ce rendez-vous a une signification qui d√©passe les protagonistes ?\n\n3. Qu'est-ce qui se passerait si on inversait compl√®tement les attentes ? Si la trahison √©tait en fait un acte d'amour d√©guis√© ?",
            
            'developer': `Excellent point de d√©part pour un ${currentProject.type}.\n\nQuelques questions pour approfondir :\n\n- Quel est l'enjeu √©motionnel central pour le personnage principal ?\n- Comment ce rituel s'inscrit-il dans la structure temporelle de votre r√©cit ?\n- Y a-t-il un secret qui relie tous les √©l√©ments que vous avez mentionn√©s ?\n\nPour un ${currentProject.type}, je sugg√®re de travailler sur l'arc √©motionnel du personnage principal en parall√®le avec ces intuitions.`,
            
            'resister': "Attention aux clich√©s ici.\n\nLe coup du 'rendez-vous annuel myst√©rieux' a √©t√© fait 1000 fois (Groundhog Day, Before Sunrise, etc.). Qu'est-ce qui rend VOTRE version unique ?\n\nLa trahison dans l'intimit√© : d'accord, mais quelle est la vraie source du conflit ? Ne tombez pas dans le pi√®ge de la psychologie simpliste.\n\nChallenges √† relever :\n- √âviter le twist pr√©visible\n- Aller au-del√† de l'ironie facile\n- Trouver une v√©ritable tension originale"
        };
        
        const response = demoResponses[currentDialogueMode] || demoResponses['developer'];
        addMessage('assistant', response + "\n\n---\nüí° Mode D√âMO activ√©. Pour utiliser l'API Claude, configurez votre cl√© API dans le code.");
        return;
    }

    // MODE PRODUCTION : vraie API Claude
    try {
        if (!API_KEY) {
            throw new Error('Cl√© API non configur√©e. Modifiez la variable API_KEY dans le code.');
        }

        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': API_KEY,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 1000,
                messages: [
                    { role: 'user', content: fullPrompt }
                ]
            })
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`API Error: ${response.status} - ${errorData.error?.message || response.statusText}`);
        }

        const data = await response.json();
        
        if (data.content && data.content[0] && data.content[0].text) {
            addMessage('assistant', data.content[0].text);
        } else {
            throw new Error('Format de r√©ponse invalide');
        }
    } catch (error) {
        console.error('Erreur API:', error);
        addMessage('assistant', "‚ö†Ô∏è Erreur lors de l'appel √† l'API Claude: " + error.message + "\n\nPour tester l'interface, activez USE_DEMO_MODE = true dans le code.");
    }
}

// ==========================================
// TESTS / COMBINATIONS
// ==========================================

function selectComboMode(mode) {
    currentComboMode = mode;
    document.querySelectorAll('.combo-mode-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
}

function generateRandomCombo() {
    if (currentProject.clouds.length < 2) {
        alert('Il faut au moins 2 nuages');
        return;
    }

    const numClouds = Math.min(Math.floor(Math.random() * 3) + 2, currentProject.clouds.length);
    const shuffled = [...currentProject.clouds].sort(() => 0.5 - Math.random());
    selectedClouds = shuffled.slice(0, numClouds).map(c => c.id);
    
    renderCloudSelectorTests();
    updateActiveComboClouds();
}

function updateActiveComboClouds() {
    const container = document.getElementById('activeComboClouds');
    container.innerHTML = '';

    selectedClouds.forEach(id => {
        const cloud = currentProject.clouds.find(c => c.id === id);
        if (!cloud) return;

        const tag = document.createElement('div');
        tag.className = 'combo-cloud-tag';
        tag.innerHTML = `
            ${cloud.content.substring(0, 40)}...
            <span class="remove-tag" onclick="removeFromCombo(${id})">√ó</span>
        `;
        container.appendChild(tag);
    });
}

function removeFromCombo(cloudId) {
    const index = selectedClouds.indexOf(cloudId);
    if (index > -1) {
        selectedClouds.splice(index, 1);
        renderCloudSelectorTests();
        updateActiveComboClouds();
    }
}

async function analyzeCombo() {
    if (selectedClouds.length < 2) {
        alert('S√©lectionnez au moins 2 nuages');
        return;
    }

    const resultDiv = document.getElementById('comboResult');
    resultDiv.style.display = 'block';
    resultDiv.textContent = 'Analyse en cours...';

    const cloudTexts = selectedClouds.map(id => {
        const cloud = currentProject.clouds.find(c => c.id === id);
        return cloud ? cloud.content : '';
    }).filter(Boolean).join('\n\n');

    const question = document.getElementById('comboQuestion').value || "Qu'est-ce que √ßa raconte ?";

    let prompt = `Type: ${currentProject.type}\n\nIntuitions:\n${cloudTexts}\n\nQuestion: ${question}`;

    // MODE DEMO
    if (USE_DEMO_MODE) {
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const demoResult = `L'√©pouse devient simultan√©ment victime et complice, manipulatrice et spectatrice de sa propre tromperie.\n\nLe genre navigue entre com√©die grin√ßante et thriller psychologique √©rotique, port√© par une tonalit√© de fausse respectabilit√© bourgeoise. Cette ironie dramatique glaciale √©voque l'univers de Chabrol autant que celui de Dahl : sous le vernis de la famille mod√®le se cache un jeu de pouvoir sophistiqu√© et pervers.\n\nLa singularit√© r√©side dans cette architecture narrative en miroir : deux √©pisodes, deux voix, deux ignorances compl√©mentaires. Rapha√´l ignore qu'il ne trompe personne, son √©pouse sait qu'elle n'est pas tromp√©e. Cette asym√©trie de savoir cr√©e une tension d√©licieusement malsaine.\n\nüí° Mode D√âMO activ√©`;
        
        resultDiv.textContent = demoResult;
        return;
    }

    // MODE PRODUCTION
    try {
        if (!API_KEY) {
            throw new Error('Cl√© API non configur√©e');
        }

        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': API_KEY,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 1000,
                messages: [{ role: 'user', content: prompt }]
            })
        });

        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }

        const data = await response.json();
        resultDiv.textContent = data.content[0].text;
    } catch (error) {
        resultDiv.textContent = "‚ö†Ô∏è Erreur: " + error.message;
    }
}

function saveCurrentCombo() {
    if (selectedClouds.length < 2) {
        alert('S√©lectionnez au moins 2 nuages');
        return;
    }

    const resultDiv = document.getElementById('comboResult');
    if (!resultDiv.textContent || resultDiv.textContent === 'Analyse en cours...') {
        alert('Analysez d\'abord la combinaison');
        return;
    }

    const combo = {
        id: Date.now(),
        clouds: selectedClouds.map(id => {
            const cloud = currentProject.clouds.find(c => c.id === id);
            return { id: cloud.id, content: cloud.content };
        }),
        result: resultDiv.textContent,
        createdAt: new Date().toISOString()
    };

    if (!currentProject.combinations) {
        currentProject.combinations = [];
    }
    currentProject.combinations.push(combo);
    saveToLocalStorage();
    renderSavedCombinations();
    alert('Combinaison sauvegard√©e !');
}

function renderSavedCombinations() {
    const container = document.getElementById('savedCombinations');
    container.innerHTML = '';

    if (!currentProject.combinations || currentProject.combinations.length === 0) {
        container.innerHTML = '<div class="empty-state">Aucune combinaison sauvegard√©e</div>';
        return;
    }

    currentProject.combinations.forEach(combo => {
        const card = document.createElement('div');
        card.className = 'saved-combo';
        
        const date = new Date(combo.createdAt).toLocaleDateString('fr-FR');
        
        card.innerHTML = `
            <div class="saved-combo-header">
                <div class="saved-combo-title">Cruaut√© exquise</div>
            </div>
            <div class="saved-combo-meta">${combo.clouds.length} nuages ‚Ä¢ ${date}</div>
            <div class="saved-combo-actions">
                <button class="combo-action-btn" onclick="loadCombo(${combo.id})">Charger</button>
                <button class="combo-action-btn" onclick="compareCombo(${combo.id})">Comparer</button>
                <button class="combo-action-btn" onclick="deleteCombo(${combo.id})">√ó</button>
            </div>
        `;
        
        container.appendChild(card);
    });
}

function loadCombo(comboId) {
    const combo = currentProject.combinations.find(c => c.id === comboId);
    if (!combo) return;

    selectedClouds = combo.clouds.map(c => c.id);
    renderClouds();
    updateActiveComboClouds();
    document.getElementById('comboResult').style.display = 'block';
    document.getElementById('comboResult').textContent = combo.result;
}

function deleteCombo(comboId) {
    if (!confirm('Supprimer cette combinaison ?')) return;
    
    currentProject.combinations = currentProject.combinations.filter(c => c.id !== comboId);
    saveToLocalStorage();
    renderSavedCombinations();
}

function compareCombo(comboId) {
    alert('Fonctionnalit√© "Comparer" √† venir');
}

// ==========================================
// TEASER
// ==========================================

function renderComboSelector() {
    const container = document.getElementById('comboSelectorList');
    container.innerHTML = '';

    if (!currentProject.combinations || currentProject.combinations.length === 0) {
        container.innerHTML = '<div class="empty-state">Aucune combinaison disponible</div>';
        return;
    }

    currentProject.combinations.forEach(combo => {
        const item = document.createElement('div');
        item.className = 'combo-item';
        item.onclick = () => selectComboForTeaser(combo.id);
        
        const date = new Date(combo.createdAt).toLocaleDateString('fr-FR');
        
        item.innerHTML = `
            <div class="combo-item-header">
                <span>‚úì</span> Cruaut√© exquise
            </div>
            <div class="combo-item-meta">${combo.clouds.length} nuages ‚Ä¢ ${date}</div>
        `;
        
        container.appendChild(item);
    });
}

async function selectComboForTeaser(comboId) {
    const combo = currentProject.combinations.find(c => c.id === comboId);
    if (!combo) return;

    document.querySelectorAll('.combo-item').forEach(item => {
        item.classList.remove('selected');
    });
    event.target.closest('.combo-item').classList.add('selected');

    const teaserDiv = document.getElementById('teaserContent');
    teaserDiv.textContent = 'G√©n√©ration du teaser...';

    const prompt = `Type: ${currentProject.type}\n\nCombinaison:\n${combo.result}\n\n√âcris un teaser narratif captivant et myst√©rieux. 3-4 paragraphes.`;

    // MODE DEMO
    if (USE_DEMO_MODE) {
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const demoTeaser = `Chaque 15 janvier, Rapha√´l quitte sa maison bourgeoise sous le m√™me pr√©texte : fleurir la tombe de sa m√®re. Un mensonge qui lui p√®se autant qu'il le lib√®re. Car avant le cimeti√®re, il y a cette chambre d'h√¥tel. Toujours la m√™me, depuis dix ans. Chambre 237.

Il s'assoit au bord du lit, noue le bandeau sur ses yeux et attend. Les minutes s'√©tirent comme une pri√®re. Puis elle arrive ‚Äì silencieuse, v√™tue de latex, parfaitement anonyme. Leurs corps se reconnaissent dans l'obscurit√© volontaire, leurs gestes suivent une chor√©graphie devenue sacr√©e. Elle le guide vers des sommets d'extase qu'il ne soup√ßonnait plus possibles, avant de dispara√Ætre comme une apparition.

Qui est cette femme ? Comment conna√Æt-elle si bien ses d√©sirs les plus secrets ?

√Ä cinquante ans, Rapha√´l croit tromper sa femme avec une inconnue. Mais certaines v√©rit√©s ont le go√ªt amer de l'ironie, et les secrets les mieux gard√©s se nichent parfois dans l'intimit√© de nos propres foyers.

üí° Mode D√âMO activ√©`;
        
        teaserDiv.textContent = demoTeaser;
        currentProject.teaser = demoTeaser;
        saveToLocalStorage();
        return;
    }

    // MODE PRODUCTION
    try {
        if (!API_KEY) {
            throw new Error('Cl√© API non configur√©e');
        }

        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': API_KEY,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 1000,
                messages: [{ role: 'user', content: prompt }]
            })
        });

        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }

        const data = await response.json();
        const teaser = data.content[0].text;
        teaserDiv.textContent = teaser;
        currentProject.teaser = teaser;
        saveToLocalStorage();
    } catch (error) {
        teaserDiv.textContent = "‚ö†Ô∏è Erreur: " + error.message;
    }
}

function proposeTeaser() {
    const teaser = prompt('Proposez votre teaser:');
    if (teaser) {
        document.getElementById('teaserContent').textContent = teaser;
        currentProject.teaser = teaser;
        saveToLocalStorage();
    }
}

function clearTeaser() {
    document.getElementById('teaserContent').textContent = 'S√©lectionnez une combinaison pour g√©n√©rer un teaser...';
    currentProject.teaser = '';
    saveToLocalStorage();
}

function validateTeaser() {
    alert('Teaser valid√© ! Passage √† la Phase 2');
}

// ==========================================
// PROJECT MANAGEMENT
// ==========================================

function showNewProjectModal() {
    document.getElementById('newProjectModal').classList.remove('hidden');
}

function closeNewProjectModal() {
    document.getElementById('newProjectModal').classList.add('hidden');
}

function createProject() {
    const name = document.getElementById('newProjectName').value.trim();
    const typeRadio = document.querySelector('input[name="projectType"]:checked');
    const type = typeRadio ? typeRadio.value : 's√©rie';

    if (!name) {
        alert('Entrez un nom');
        return;
    }

    currentProject = {
        id: Date.now(),
        name: name,
        type: type,
        clouds: [],
        combinations: [],
        teaser: ''
    };

    document.getElementById('projectName').textContent = name;
    document.getElementById('projectType').textContent = type;
    saveToLocalStorage();
    closeNewProjectModal();
    switchTab('nuages');
}

function showSettings() {
    const newName = prompt('Renommer le projet:', currentProject.name);
    if (newName && newName.trim()) {
        currentProject.name = newName.trim();
        document.getElementById('projectName').textContent = currentProject.name;
        saveToLocalStorage();
    }
}

// ==========================================
// START
// ==========================================

init();

// Support Enter key
document.getElementById('dialogueInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
});
</script>

</body>
</html>